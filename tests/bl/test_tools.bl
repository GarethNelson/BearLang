; this file contains the tools for running automated tests

(oper RESET-TESTS () 
      (= TESTS_PASSED 0)
      (= TESTS_FAILED 0))

(oper TEST (testname testfunc)
      (= TESTING (eval testfunc))
      (print "\tTesting " testname)

      (oper PASSTEST () 
            (if (not (isset TESTS_PASSED))
	             (= TESTS_PASSED 1)
                     (= TESTS_PASSED (+ TESTS_PASSED 1)))
            (print " PASS\n"))

      (oper FAILTEST ()
	    (if (not (isset TESTS_FAILED))
	             (= TESTS_FAILED 1)
		     (= TESTS_FAILED (+ TESTS_FAILED 1)))
	    (print " FAIL\n"))
      
      (if (TESTING) (PASSTEST)
                    (FAILTEST))

      )

(oper BEGIN-TEST (test-desc tests) 
      (RESET-TESTS)
      (print test-desc "\n")
      (foreach t tests (eval t))
      )

(fun TEST-SUMMARY ()
     (print "\n")
     (print (+ TESTS_PASSED TESTS_FAILED) " Tests run,")
     (print TESTS_PASSED  " passed,")
     (print TESTS_FAILED  " failed\n\n"))
